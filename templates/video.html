<!DOCTYPE html>
<html>
<head>
    <title>Sign Language Recognition</title>
     <link rel="stylesheet" href="../static/assets/css/style.css">
    <link rel="stylesheet" href="../static/assets/css/bootstrap.min.css">
    <style>
        #webcam-feed {
            transform: scaleX(-1); /* Flips the video horizontally */
        }
    </style>
</head>
<body>
    <body class="inner">
    <div class="container  my-5 card">
        <div class="row">
            <div class="py-large col-lg-6 order-lg-1 order-2 pl-4 pr-5">

                <a class="inner-link" href="http://127.0.0.1:8000/"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                        height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                    </svg> Home</a>

                <div class="section-title mt-3" style="margin-bottom: 45px;">
                    <h3>Sign Language to Word(WLASL)</h3>
                    <span style="margin-left: 0;"></span>
                </div>
                <div class="cam-feed" id="current-symbol">
                    <p>Sentence :</p>
                    <div class="text-box">
                        <span class="text-input" id="recognized-sentence"></span>
                    </div>
                </div>
 
            </div>
            <div class="col-lg-6 order-lg-2 order-1 d-flex align-items-center justify-content-center bg"
                style="background-image: url('../static/assets/img/abstrac.jpg');">
                
                <div id="image-panel" class=" d-flex justify-content-end align-items-center round h-100">
                    <video id="webcam-feed"  autoplay width="500" height="400"></video>
                    <!-- <img id="videoFeed" src="" width="500" height="400" alt="Camera Feed"> -->
                </div>
            </div>
        </div>



    </div>

    


    <script>
        const video = document.getElementById('webcam-feed');
        const sentenceDisplay = document.getElementById('recognized-sentence');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const ws_scheme = window.location.protocol === "https:" ? "wss" : "ws";
        const socket = new WebSocket(ws_scheme + '://' + window.location.host + '/ws/video/');

        // Get access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(error) {
                console.log("Webcam access denied or unavailable: ", error);
            });

            
 video.addEventListener('play', () => {
        // Define the function that sends a single frame
        function sendFrame() {
            if (socket.readyState === WebSocket.OPEN) {
                // Ensure the canvas size matches the video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Convert the frame to a base64 encoded JPEG string
                const imageData = canvas.toDataURL('image/jpeg', 0.6);

                // Send the data over the WebSocket
                socket.send(JSON.stringify({ 'frame': imageData }));
            }

            // Schedule the next frame to be sent on the next available animation frame
            requestAnimationFrame(sendFrame);
        }
        
        // Start the loop
        requestAnimationFrame(sendFrame);
    });

    // Listen for the recognized sentence from the backend
    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        sentenceDisplay.textContent += data.sentence + " ";
    };
    </script>
</body>
</html>