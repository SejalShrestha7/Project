<!DOCTYPE html>
<html>
<head>
    <title>Sign Language Recognition</title>
    <style>
        #webcam-feed {
            transform: scaleX(-1); /* Flips the video horizontally */
        }
    </style>
</head>
<body>
    <h1>Real-time Sign Language Recognition</h1>
    <video id="webcam-feed" autoplay width="900" height="800"></video>
    <h2 id="recognized-sentence"></h2>

    <script>
        const video = document.getElementById('webcam-feed');
        const sentenceDisplay = document.getElementById('recognized-sentence');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const ws_scheme = window.location.protocol === "https:" ? "wss" : "ws";
        const socket = new WebSocket(ws_scheme + '://' + window.location.host + '/ws/video/');

        // Get access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(error) {
                console.log("Webcam access denied or unavailable: ", error);
            });

            
 video.addEventListener('play', () => {
        // Define the function that sends a single frame
        function sendFrame() {
            if (socket.readyState === WebSocket.OPEN) {
                // Ensure the canvas size matches the video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Convert the frame to a base64 encoded JPEG string
                const imageData = canvas.toDataURL('image/jpeg', 0.6);

                // Send the data over the WebSocket
                socket.send(JSON.stringify({ 'frame': imageData }));
            }

            // Schedule the next frame to be sent on the next available animation frame
            requestAnimationFrame(sendFrame);
        }
        
        // Start the loop
        requestAnimationFrame(sendFrame);
    });

    // Listen for the recognized sentence from the backend
    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        sentenceDisplay.textContent += data.sentence + " ";
    };
    </script>
</body>
</html>